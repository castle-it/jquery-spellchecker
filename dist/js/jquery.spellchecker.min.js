/*! jquery.spellchecker - v0.2.6 - 2015-05-05 */!function(a,b){var c={lang:"en",webservice:{path:"spellchecker.php",driver:"PSpell"},local:{requestError:"There was an error processing the request.",ignoreWord:"Ignore word",ignoreAll:"Ignore all",ignoreForever:"Add to dictionary",loading:"Loading...",noSuggestions:"(No suggestions)"},suggestBox:{numWords:5,position:"above",offset:2,appendTo:null},incorrectWords:{container:"body",position:null}},d="spellchecker";Function.prototype.bind||(Function.prototype.bind=function(a){return b.proxy(this,a)});var e=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},f=function(a){return b("<div />").html(a).html()};RegExp.escape=function(a){return a.replace(/[\-\[\]{}()*+?.,\^$|#\s]/g,"\\$&")};var g="\\u0021-\\u0023\\u0025-\\u002A\\u002C-\\u002F\\u003A\\u003B\\u003F\\u0040\\u005B-\\u005D\\u005F\\u007B\\u007D\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65",h=function(){this._handlers={}};h.prototype={on:function(a,c){this._handlers[a]||(this._handlers[a]=b.Callbacks()),this._handlers[a].add(c)},trigger:function(a){var c=Array.prototype.slice.call(arguments,1);return b.isFunction(a)?a.apply(this,c):void(this._handlers[a]&&this._handlers[a].fireWith(this,c))},handler:function(a){return function(b){this.trigger(a,b)}.bind(this)}};var i=function(a){return function(c){c.preventDefault(),c.stopPropagation();var d=b(c.currentTarget),e=b.trim(d.data("word")||d.text());this.trigger(a,c,e,d,this)}.bind(this)},j=function(a,b){this.instances=[];for(var c=0;c<a.length;c++)this.instances.push(b(a[c]));this.methods(["on","destroy","trigger"])};j.prototype.methods=function(a){b.each(a,function(a,b){this[b]=function(){this.execute(b,arguments)}.bind(this)}.bind(this))},j.prototype.execute=function(a,c){b.each(this.instances,function(b,d){d[a].apply(d,c)})},j.prototype.get=function(a){return this.instances[a]};var k=function(a,c,d,e){h.call(this),this.config=a,this.parser=c,this.spellCheckerElement=b(d),this.findAndReplaceDOMText=e,this.createBox(),this.bindEvents()};e(k,h);var l=function(a,b,c,d){k.apply(this,arguments)};e(l,k),l.prototype.bindEvents=function(){this.container.on("click","a",i.call(this,"select.word")),this.on("addWords",this.addWords.bind(this))},l.prototype.createBox=function(){this.container=b(['<div class="'+d+'-incorrectwords">',"</div>"].join("")).hide(),b.isFunction(this.config.incorrectWords.position)?this.config.incorrectWords.position.call(this.spellCheckerElement,this.container):this.container.appendTo(this.config.incorrectWords.container)},l.prototype.addWords=function(a){a=b.grep(a,function(c,d){return d===b.inArray(c,a)});var c=b.map(a,function(a){return'<a href="#">'+a+"</a>"}).join("");this.container.html(c).show()},l.prototype.removeWord=function(a){a&&a.remove(),0===this.container.children().length&&this.container.hide()},l.prototype.destroy=function(){this.container.empty().remove()};var m=function(a,c,d,e){h.call(this),this.config=a,this.parser=c,this.spellCheckerElement=this.element=b(d),this.findAndReplaceDOMText=e,this.bindEvents()};e(m,h),m.prototype.bindEvents=function(){this.element.on("click."+d,"."+d+"-word-highlight",i.call(this,"select.word"))},m.prototype.addWords=function(a){var b=this.parser.highlightWords(a,this.element);this.element.html(b)},m.prototype.removeWord=function(a){},m.prototype.destroy=function(){this.element.off("."+d);try{this.findAndReplaceDOMText.revert()}catch(a){}};var n=function(a,c){this.element=c,a.suggestBox.appendTo?this.body=b(a.suggestBox.appendTo):this.body=this.element.length&&"BODY"===this.element[0].nodeName?this.element:"body",this.position=b.isFunction(a.suggestBox.position)?a.suggestBox.position:this.position,k.apply(this,arguments)};e(n,k),n.prototype.bindEvents=function(){var a="click."+d;this.container.on(a,this.onContainerClick.bind(this)),this.container.on(a,".ignore-word",i.call(this,"ignore.word")),this.container.on(a,".ignore-all",this.handler("ignore.all")),this.container.on(a,".ignore-forever",this.handler("ignore.forever")),this.container.on(a,".words a",i.call(this,"select.word")),b("html").on(a,this.onWindowClick.bind(this)),"BODY"===this.element[0].nodeName&&this.element.parent().on(a,this.onWindowClick.bind(this))},n.prototype.createBox=function(){var a=this.config.local;this.container=b(['<div class="'+d+'-suggestbox">',' <div class="footer">','   <a href="#" class="ignore-word">'+a.ignoreWord+"</a>",'   <a href="#" class="ignore-all">'+a.ignoreAll+"</a>",'   <a href="#" class="ignore-forever">'+a.ignoreForever+"</a>"," </div>","</div>"].join("")).appendTo(this.body),this.words=b(['<div class="words">',"</div>"].join("")).prependTo(this.container),this.loadingMsg=b(['<div class="loading">',this.config.local.loading,"</div>"].join("")),this.footer=this.container.find(".footer").hide()},n.prototype.addWords=function(a){var c;c=a.length?b.map(a,function(a){return'<a href="#">'+a+"</a>"}).slice(0,this.config.suggestBox.numWords).join(""):"<em>"+this.config.local.noSuggestions+"</em>",this.words.html(c)},n.prototype.showSuggestedWords=function(a,c,d){this.wordElement=b(d),a(c,this.onGetWords.bind(this))},n.prototype.loading=function(a){this.footer.hide(),this.words.html(a?this.loadingMsg.clone():""),this.position(),this.open()},n.prototype.position=function(){var c,d=b(a),e=this.wordElement.data("firstElement")||this.wordElement,f=e.offset(),g=this.config.suggestBox.offset,h=this.container.outerHeight(),i=f.top-h-g,j=f.top+e.outerHeight()+g,k=f.left;"below"===this.config.suggestBox.position?(c=j,d.height()+d.scrollTop()<j+h&&(c=i)):c=i,this.container.css({top:c,left:k})},n.prototype.open=function(){this.position(),this.container.fadeIn(180)},n.prototype.close=function(){this.container.fadeOut(100,function(){this.footer.hide()}.bind(this))},n.prototype.detach=function(){this.container=this.container.detach()},n.prototype.reattach=function(){this.container.appendTo(this.body)},n.prototype.onContainerClick=function(a){a.stopPropagation()},n.prototype.onWindowClick=function(a){this.close()},n.prototype.onGetWords=function(a){this.addWords(a),this.footer.show(),this.position(),this.open()},n.prototype.destroy=function(){this.container.empty().remove()};var o=function(a){this.config=a,this.defaultConfig={url:a.webservice.path,type:"POST",dataType:"json",cache:!1,data:{lang:a.lang,driver:a.webservice.driver},error:function(){1===b(".spell_checker_dialog").size()&&b(".spell_checker_dialog").dialog?b(".dialog").html(a.local.requestError).dialog({width:300,height:175,title:"Error!",modal:!0,buttons:[{text:"OK",click:function(){b(this).dialog("close")}}]}):alert(a.local.requestError)}.bind(this)}};o.prototype.makeRequest=function(a){var c=b.extend(!0,{},this.defaultConfig);return b.ajax(b.extend(!0,c,a))},o.prototype.checkWords=function(a,b){return this.makeRequest({data:{action:"get_incorrect_words",text:a},success:b})},o.prototype.getSuggestions=function(a,b){return this.makeRequest({url:this.config.webservice.suggestionPath||this.config.webservice.path,data:{action:"get_suggestions",word:a},success:b})};var p=function(a,b,c){this.elements=a,this.findAndReplaceDOMText=b,this.replacementContainer=null,this.config=c};p.prototype.clean=function(a){a=""+a,a=f(a),a=a.replace(/\xA0|\s+|(&nbsp;)/gm," "),a=a.replace(new RegExp("<[^>]+>","g"),"");var c=["(^|\\s+)["+g+"]+","["+g+"]+\\s+["+g+"]+","["+g+"]+(\\s+|$)"].join("|");return a=a.replace(new RegExp(c,"g")," "),a=b.trim(a.replace(/\s{2,}/g," ")),a=b.map(a.split(" "),function(a){return/^\d+$/.test(a)?null:a}).join(" ")};var q=function(){p.apply(this,arguments)};e(q,p),q.prototype.getText=function(a,c){return b.map(this.elements,function(a){return this.clean(c?c(a):b(a).val())}.bind(this))},q.prototype.replaceWordInText=function(a,b,c){var d=new RegExp("\\b("+RegExp.escape(a)+")\\b","g");return(c+"").replace(d,"$1"+b)},q.prototype.replaceWord=function(a,c,d){d=b(d);var e=this.replaceWordInText(a,c,d.val());d.val(e)};var r=function(){p.apply(this,arguments)};e(r,p),r.prototype.getText=function(a,c){return a&&(a=b(a)).length?this.clean(a.text()):b.map(this.elements,function(d){return a=c?c(d):b(d).clone().find('[class^="spellchecker-"]').remove().end().text(),this.clean(a)}.bind(this))},r.prototype.replaceText=function(a,b,c,d){this.replacementContainer=this.findAndReplaceDOMText(b,{find:a,replace:c,filterElements:this.config.filterElements})},r.prototype.replaceWord=function(a,c,d){try{this.replacementContainer.revert()}catch(e){}var f=new RegExp("\\b("+RegExp.escape(a)+")\\b","g");this.replaceText(f,d[0],this.replaceTextHandler(a,c),2),this.incorrectWords=b.map(this.incorrectWords||[],function(b){return b===a?null:b}),this.highlightWords(this.incorrectWords,d)},r.prototype.replaceTextHandler=function(a,b){var c,d,e,f=b;return function(g,h){return h!==e&&(e=h,b=f,c=""),d=b.substring(0,g.length),b=b.substr(g.length),c+=g,c===a&&(d+=b),document.createTextNode(d)}},r.prototype.highlightWords=function(a,c){if(a.length){this.incorrectWords=a,a=b.map(a,function(a){return RegExp.escape(a)});var d=new RegExp("\\b("+a.join("|")+")\\b","g");this.replaceText(d,c[0],this.highlightWordsHandler(a),2)}},r.prototype.highlightWordsHandler=function(a){var c,e;return function(a,f,g){var h=b("<span />",{"class":d+"-word-highlight"});return f!==c&&(c=f,e=h),h.text(a.text).data({firstElement:e,word:a.text}),h[0]}},r.prototype.ignoreWord=function(a,b){this.replaceWord(a,b)};var s=function(a,d){h.call(this),this.elements=b(a).attr("spellcheck","false");var e=b.extend(!0,{},c);this.config=b.extend(!0,e,d),this.findAndReplaceDOMText=findAndReplaceDOMText,this.setupWebService(),this.setupParser(),this.elements.length&&(this.setupSuggestBox(),this.setupIncorrectWords(),this.bindEvents())};e(s,h),s.prototype.setupWebService=function(){this.webservice=new o(this.config)},s.prototype.setupSuggestBox=function(){this.suggestBox=new n(this.config,this.elements),this.on("replace.word.before",function(){this.suggestBox.close(),this.suggestBox.detach()}.bind(this)),this.on("replace.word",function(){this.suggestBox.reattach()}.bind(this)),this.on("destroy",function(){this.suggestBox.destroy()}.bind(this))},s.prototype.setupIncorrectWords=function(){var a=this.findAndReplaceDOMText;this.incorrectWords=new j(this.elements,function(b){return"html"===this.config.parser?new m(this.config,this.parser,b,a):new l(this.config,this.parser,b,a)}.bind(this)),this.on("replace.word",function(a){this.incorrectWords.get(a).removeWord(this.incorrectWordElement)}.bind(this)),this.on("destroy",function(){this.incorrectWords.destroy()},this)},s.prototype.setupParser=function(){this.parser="html"===this.config.parser?new r(this.elements,this.findAndReplaceDOMText,this.config):new q(this.elements,this.findAndReplaceDOMText,this.config)},s.prototype.bindEvents=function(){this.on("check.fail",this.onCheckFail.bind(this)),this.suggestBox.on("ignore.word",this.onIgnoreWord.bind(this)),this.suggestBox.on("select.word",this.onSelectWord.bind(this)),this.incorrectWords.on("select.word",this.onIncorrectWordSelect.bind(this))},s.prototype.check=function(a,b){this.trigger("check.start"),a="string"==typeof a?this.parser.clean(a):this.parser.getText(a||"",this.config.getText),a+="",this.webservice.checkWords(a,this.onCheckWords(b))},s.prototype.getSuggestions=function(a,b){this.suggestBox&&this.suggestBox.loading(!0),this.webservice.getSuggestions(a,b)},s.prototype.replaceWord=function(a,b,c){if("string"==typeof c)return this.parser.replaceWordInText(a,b,c);var d=c||this.spellCheckerElement,e=this.elements.index(d);this.trigger("replace.word.before"),this.parser.replaceWord(a,b,d),this.trigger("replace.word",e)},s.prototype.destroy=function(){this.trigger("destroy")},s.prototype.onCheckWords=function(a){return function(c){var d=c.data,e="success";b.each(d,function(a,b){return b.length?(e="fail",!1):void 0}),this.trigger("check.complete"),this.trigger("check."+e,d),this.trigger(a,d)}.bind(this)},s.prototype.onCheckFail=function(a){this.suggestBox.detach(),b.each(a,function(a,c){c.length&&(c=b.grep(c,function(a,d){return d===b.inArray(a,c)}),this.incorrectWords.get(a).addWords(c))}.bind(this)),this.suggestBox.reattach()},s.prototype.onSelectWord=function(a,b,c){a.preventDefault(),this.replaceWord(this.incorrectWord,b)},s.prototype.onIgnoreWord=function(a,b,c){a.preventDefault(),this.replaceWord(this.incorrectWord,this.incorrectWord)},s.prototype.onIncorrectWordSelect=function(a,b,c,d){a.preventDefault(),this.incorrectWord=b,this.incorrectWordElement=c,this.spellCheckerElement=d.spellCheckerElement,this.spellCheckerIndex=this.elements.index(this.spellCheckerElement),this.suggestBox.showSuggestedWords(this.getSuggestions.bind(this),b,c),this.trigger("select.word",a)},b.SpellChecker=s}(this,jQuery),function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.findAndReplaceDOMText=b()}(this,function(){function a(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function b(){return c.apply(null,arguments)||d.apply(null,arguments)}function c(a,c,e,f,g){if(c&&!c.nodeType&&arguments.length<=2)return!1;var h="function"==typeof e;h&&(e=function(a){return function(b,c){return a(b.text,c.startIndex)}}(e));var i=d(c,{find:a,wrap:h?null:e,replace:h?e:"$"+(f||"&"),prepMatch:function(a,b){if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(f>0){var c=a[f];a.index+=a[0].indexOf(c),a[0]=c}return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},filterElements:g});return b.revert=function(){return i.revert()},!0}function d(a,b){return new e(a,b)}function e(a,c){var d=c.preset&&b.PRESETS[c.preset];if(c.portionMode=c.portionMode||f,d)for(var e in d)i.call(d,e)&&!i.call(c,e)&&(c[e]=d[e]);this.node=a,this.options=c,this.prepMatch=c.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var f="retain",g="first",h=document,i=({}.toString,{}.hasOwnProperty);return b.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},b.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},b.NON_INLINE_PROSE=function(a){return i.call(b.NON_CONTIGUOUS_PROSE_ELEMENTS,a.nodeName.toLowerCase())},b.PRESETS={prose:{forceContext:b.NON_INLINE_PROSE,filterElements:function(a){return!i.call(b.NON_PROSE_ELEMENTS,a.nodeName.toLowerCase())}}},b.Finder=e,e.prototype={search:function(){function b(a){for(var g=0,j=a.length;j>g;++g){var k=a[g];if("string"==typeof k){if(f.global)for(;c=f.exec(k);)h.push(i.prepMatch(c,d++,e));else(c=k.match(f))&&h.push(i.prepMatch(c,0,e));e+=k.length}else b(k)}}var c,d=0,e=0,f=this.options.find,g=this.getAggregateText(),h=[],i=this;return f="string"==typeof f?RegExp(a(f),"g"):f,b(g),h},prepMatch:function(a,b,c){if(!a[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return a.endIndex=c+a.index+a[0].length,a.startIndex=c+a.index,a.index=b,a},getAggregateText:function(){function a(d,e){if(3===d.nodeType)return[d.data];if(b&&!b(d))return[];var e=[""],f=0;if(d=d.firstChild)do if(3!==d.nodeType){var g=a(d);c&&1===d.nodeType&&(c===!0||c(d))?(e[++f]=g,e[++f]=""):("string"==typeof g[0]&&(e[f]+=g.shift()),g.length&&(e[++f]=g,e[++f]=""))}else e[f]+=d.data;while(d=d.nextSibling);return e}var b=this.options.filterElements,c=this.options.forceContext;return a(this.node)},processMatches:function(){var a,b,c,d=this.matches,e=this.node,f=this.options.filterElements,g=[],h=e,i=d.shift(),j=0,k=0,l=0,m=[e];a:for(;;){if(3===h.nodeType&&(!b&&h.length+j>=i.endIndex?b={node:h,index:l++,text:h.data.substring(i.startIndex-j,i.endIndex-j),indexInMatch:j-i.startIndex,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,isEnd:!0}:a&&g.push({node:h,index:l++,text:h.data,indexInMatch:j-i.startIndex,indexInNode:0}),!a&&h.length+j>i.startIndex&&(a={node:h,index:l++,indexInMatch:0,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,text:h.data.substring(i.startIndex-j,i.endIndex-j)}),j+=h.data.length),c=1===h.nodeType&&f&&!f(h),a&&b){if(h=this.replaceMatch(i,a,g,b),j-=b.node.data.length-b.endIndexInNode,a=null,b=null,g=[],i=d.shift(),l=0,k++,!i)break}else if(!c&&(h.firstChild||h.nextSibling)){h.firstChild?(m.push(h),h=h.firstChild):h=h.nextSibling;continue}for(;;){if(h.nextSibling){h=h.nextSibling;break}if(h=m.pop(),h===e)break a}}},revert:function(){for(var a=this.reverts.length;a--;)this.reverts[a]();this.reverts=[]},prepareReplacementString:function(a,b,c,d){var e=this.options.portionMode;return e===g&&b.indexInMatch>0?"":(a=a.replace(/\$(\d+|&|`|')/g,function(a,b){var d;switch(b){case"&":d=c[0];break;case"`":d=c.input.substring(0,c.startIndex);break;case"'":d=c.input.substring(c.endIndex);break;default:d=c[+b]}return d}),e===g?a:b.isEnd?a.substring(b.indexInMatch):a.substring(b.indexInMatch,b.indexInMatch+b.text.length))},getPortionReplacementNode:function(a,b,c){var d=this.options.replace||"$&",e=this.options.wrap;if(e&&e.nodeType){var f=h.createElement("div");f.innerHTML=e.outerHTML||(new XMLSerializer).serializeToString(e),e=f.firstChild}if("function"==typeof d)return d=d(a,b,c),d&&d.nodeType?d:h.createTextNode(String(d));var g="string"==typeof e?h.createElement(e):e;return d=h.createTextNode(this.prepareReplacementString(d,a,b,c)),d.data&&g?(g.appendChild(d),g):d},replaceMatch:function(a,b,c,d){var e,f,g=b.node,i=d.node;if(g===i){var j=g;b.indexInNode>0&&(e=h.createTextNode(j.data.substring(0,b.indexInNode)),j.parentNode.insertBefore(e,j));var k=this.getPortionReplacementNode(d,a);return j.parentNode.insertBefore(k,j),d.endIndexInNode<j.length&&(f=h.createTextNode(j.data.substring(d.endIndexInNode)),j.parentNode.insertBefore(f,j)),j.parentNode.removeChild(j),this.reverts.push(function(){e===k.previousSibling&&e.parentNode.removeChild(e),f===k.nextSibling&&f.parentNode.removeChild(f),k.parentNode.replaceChild(j,k)}),k}e=h.createTextNode(g.data.substring(0,b.indexInNode)),f=h.createTextNode(i.data.substring(d.endIndexInNode));for(var l=this.getPortionReplacementNode(b,a),m=[],n=0,o=c.length;o>n;++n){var p=c[n],q=this.getPortionReplacementNode(p,a);p.node.parentNode.replaceChild(q,p.node),this.reverts.push(function(a,b){return function(){b.parentNode.replaceChild(a.node,b)}}(p,q)),m.push(q)}var r=this.getPortionReplacementNode(d,a);return g.parentNode.insertBefore(e,g),g.parentNode.insertBefore(l,g),g.parentNode.removeChild(g),i.parentNode.insertBefore(r,i),i.parentNode.insertBefore(f,i),i.parentNode.removeChild(i),this.reverts.push(function(){e.parentNode.removeChild(e),l.parentNode.replaceChild(g,l),f.parentNode.removeChild(f),r.parentNode.replaceChild(i,r)}),r}},b});